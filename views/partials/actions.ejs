<div class="slds-text-heading_medium"> <a href="/cleanup">Cleanup entries</a>
	<br />
</div>

<div class="slds-text-heading_medium">Send Status:
	<span id="status"></span>
</div>
<br />

<table class="slds-table slds-table_cell-buffer slds-table_bordered">
	<thead>
		<tr>
			<th>Name</th>
			<th>Email</th>
			<th>OrgId</th>
			<th>instanceUrl</th>
			<th>Username</th>
		</tr>
	</thead>
	<tbody>
		<% for(var i=0; i < users.length; i++) { %>

		<tr>
			<td>
				<%= users[i].name %>
			</td>
			<td>
				<%= users[i].email %>
			</td>
			<td>
				<%= users[i].orgid %>
			</td>
			<td>
				<%= users[i].instanceUrl %>
			</td>
			<td>
				<%= users[i].prefUsername %>
			</td>
			<td>
				<a onClick="PostDataUsingRefreshToken('<%= users[i].id %>')">Send data - Using Refresh Token</a>
			</td>
			<td>
				<a onClick="PostDataUsingJWT('<%= users[i].id%>')">Send data - Using JWT</a>
			</td>

		</tr>
		<% } %>
	</tbody>
</table>

<script type="text/javascript">
	console.log('Client-side code running');

	function PostDataUsingRefreshToken(idtoprocess) {
		console.log('PostDataUsingRefreshToken, id=' + idtoprocess);

		let data = {
			id: idtoprocess
		};

		fetch('/SendData', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify(data)
			})
			.then(response => response.json())
			.then(data => {
				console.log(data.status) // Prints result from `response.json()` in getRequest
				document.getElementById("status").innerHTML = data.message;
			})
			.catch(function (error) {
				console.log(error);
			});

	}

	function PostDataUsingJWT(idtoprocess) {
		console.log('PostDataUsingJWT, idtoprocess=' + idtoprocess);

		let data = {
			id: idtoprocess
		};

		fetch('/SendDataByJwt', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify(data)
			})
			.then(response => response.json())
			.then(data => {
				console.log(data.status) // Prints result from `response.json()` in getRequest
				document.getElementById("status").innerHTML = data.status;
			})
			.catch(function (error) {
				console.log(error);
			});

	}
</script>